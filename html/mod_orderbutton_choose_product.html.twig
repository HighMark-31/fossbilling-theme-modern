{% set products = guest.product_get_list %}
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#products" aria-expanded="false" aria-controls="products">
            <svg class="svg-icon me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 7h12l-1 12H7L6 7zM9 7a3 3 0 016 0"/></svg>
            <span>{{ 'Select Product'|trans }}</span>&nbsp;<span class="badge bg-info">{{ products.list|length }} {{ 'Items'|trans }}</span>
        </button>
    </h2>
    <div id="products" class="accordion-collapse collapse">
        <div class="accordion-body">
            {% for i, category in guest.product_category_get_list.list %}
                <h5 {% if i > 0 %} class="mt-3" {% endif %}>{{ category.title }}</h5>
                {% if category.description %}<div class="text-muted small mb-2">{{ category.description|markdown }}</div>{% endif %}
                <div class="product-grid">
                    {% for i, product in category.products|sort((a, b) => a.priority <=> b.priority) %}
                        {% set pricing_display = '' %}
                        {% if product.pricing.type == 'recurrent' %}
                            {% set periods = guest.system_periods %}
                            {% for code,prices in product.pricing.recurrent %}
                                {% if prices.enabled and pricing_display == '' %}
                                    {% set pricing_display = prices.price | money_convert ~ ' / ' ~ periods[code] %}
                                {% endif %}
                            {% endfor %}
                        {% elseif product.pricing.type == 'free' %}
                            {% set pricing_display = 0 | money_convert %}
                        {% else %}
                            {% set pricing_display = product.pricing.once.price | money_convert %}
                        {% endif %}
                        <a class="product-card" href="{{ 'order'|link({ 'product': product.id, 'show_custom_form_values': request.show_custom_form_values }) }}">
                            <div class="d-flex align-items-start justify-content-between">
                                <div class="me-2">
                                    <div class="fw-semibold">{{ product.title }}</div>
                                    {% if product.description %}
                                        <div class="text-muted small">{{ product.description|striptags|slice(0,120) }}{% if product.description|length > 120 %}â€¦{% endif %}</div>
                                    {% endif %}
                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    {% if pricing_display %}<span class="price-pill">{{ pricing_display }}</span>{% endif %}
                                    <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L20.84 12 12.92 4.08 11.5 5.5 16 11H4"/></svg>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>