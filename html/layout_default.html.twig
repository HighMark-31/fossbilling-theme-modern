<!DOCTYPE html>
<html lang="en" data-bs-theme="{{ settings.theme|default('light') }}">
<head>
    <meta charset="utf-8">
    <title>{{ settings.meta_title_prefix }} {% block meta_title %}{% endblock %} {{ settings.meta_title_suffix }}</title>

    <meta property="bb:url" content="{{ constant('SYSTEM_URL') }}">
    <meta property="bb:client_area" content="{{ '/'|link }}">
    <meta name="csrf-token" content="{{ CSRFToken }}">

    <meta name="description" content="{% block meta_description %}{{ settings.meta_description }}{% endblock %}">
    <meta name="keywords" content="{{ settings.meta_keywords }}">
    <meta name="robots" content="{{ settings.meta_robots }}">
    <meta name="author" content="{{ settings.meta_author }}">
    <meta name="generator" content="FOSSBilling - Modern Theme by HighMark IT">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% block opengraph %}{% endblock %}
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        (function(){
            var stored = localStorage.getItem('theme');
            var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            var theme = stored || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-bs-theme', theme);
            document.documentElement.classList.toggle('dark', theme === 'dark');
            var mq = window.matchMedia('(prefers-color-scheme: dark)');
            mq.addEventListener('change', function(e){
                if (!localStorage.getItem('theme')){
                    var t = e.matches ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-bs-theme', t);
                    document.documentElement.classList.toggle('dark', t === 'dark');
                }
            });
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.7.0/github-markdown.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flag-icons@6.6.6/css/flag-icons.min.css" rel="stylesheet">
    <link href="/themes/modern/assets/css/modern.css" rel="stylesheet">
    <style>
        [data-bs-theme="light"] .hide-theme-light { display: none !important; }
        [data-bs-theme="dark"] .hide-theme-dark { display: none !important; }
    </style>
    <link rel="shortcut icon" href="{{ guest.system_company.favicon_url }}">

    {{ "Api/API.js" | library_url | script_tag }}
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js" defer></script>
    <script src="/themes/modern/assets/js/modern.cdn.js" defer></script>

    {{ DebugBar_renderHead() }}

    {% block head %}{% endblock %}
    {% block js %}{% endblock %}
</head>

<body class="modern-canvas {% block body_class %}{% endblock %}">

{% block body %}
{% if not client and settings.require_login %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const publicPaths = [
                '/news',
                '/tos',
                '/privacy-policy'
            ];
            const currentPath = window.location.pathname;

            const isAllowed = publicPaths.some(path => currentPath.startsWith(path));
            if (!isAllowed) {
                window.location.href = '{{ "login"|link }}';
            }
        });
    </script>
{% endif %}

{% if client %}
    {% set profile = client.profile_get %}
{% endif %}
{% set company = guest.system_company %}

{% if settings.theme == 'dark' %}
    {% set logo_url = company.logo_url_dark %}
{% else %}
    {% set logo_url = company.logo_url %}
{% endif %}

<header class="modern-nav">
    <nav class="container mx-auto px-4 sm:px-6 lg:px-8 modern-glass">
        <div class="flex items-center justify-between h-16">
            <div class="flex-shrink-0">
                {% if settings.show_company_logo %}
                    <a href="{{ '/'|link }}" class="flex items-center">
                        <img class="h-8 w-auto hide-theme-dark" src="{{ company.logo_url }}" alt="{{ company.name }}" title="{{ company.name }}">
                        <img class="h-8 w-auto hide-theme-light" src="{{ company.logo_url_dark }}" alt="{{ company.name }}" title="{{ company.name }}">
                    </a>
                {% else %}
                    <a href="{{ '/'|link }}" class="text-xl font-bold modern-logo-text">
                        {{ company.name }}
                    </a>
                {% endif %}
            </div>

            <div class="hidden md:flex items-center space-x-6">
                {% set languages = guest.extension_languages(true) %}
                {% if languages|length > 1 %}
                    <div class="relative">
                        <select name="lang" class="modern-form-input !py-1 !px-2 text-sm js-language-selector">
                            {% for lang in languages %}
                                <option value="{{ lang.locale }}" data-custom-properties="&lt;span class=&quot;fi fi-{{ lang.locale|split('_')[1]|lower }}&quot;&gt;&lt;/span&gt;">&nbsp;{{ lang.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}

                {% if settings.top_menu_dashboard %}
                    <a href="{{ ''|link }}" class="modern-nav-link">{{ 'Dashboard'|trans }}</a>
                {% endif %}

                {% if settings.top_menu_order %}
                    <a href="{{ '/order'|link }}" class="modern-nav-link">{{ 'Order'|trans }}</a>
                {% endif %}

                {% if settings.top_menu_profile %}
                    {% if not client %}
                        <a href="{{ 'login'|link }}" class="modern-btn-secondary">{{ 'Login'|trans }}</a>
                    {% endif %}
                {% endif %}

                {% if settings.top_menu_signout %}
                    {% if client %}
                        <div class="relative">
                            <button type="button" class="modern-btn-secondary flex items-center space-x-2" data-bs-toggle="dropdown">
                                <img class="h-6 w-6 rounded-full" alt="{{ profile.first_name }} {{ profile.last_name }} gravatar" src="{{ profile.email|gravatar(60) }}">
                                <span class="hidden lg:block">
                                    {% if profile.company %}
                                        {{ profile.first_name }} {{ profile.last_name }} ({{ profile.company }})
                                    {% else %}
                                        {{ profile.first_name }} {{ profile.last_name }}
                                    {% endif %}
                                </span>
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="dropdown-menu modern-dropdown min-w-[200px]">
                                <a class="modern-dropdown-item" href="{{ 'client/profile'|link }}">
                                    <svg class="h-4 w-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    {{ 'Profile'|trans }}
                                </a>
                                <a class="modern-dropdown-item" href="{{ 'client/logout'|link }}">
                                    <svg class="h-4 w-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                    {{ 'Sign out'|trans }}
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ 'signup'|link }}" class="modern-btn-primary">{{ 'Register'|trans }}</a>
                    {% endif %}
                {% endif %}

                <div class="modern-switch hidden md:inline-flex ml-2">
                    <input type="checkbox" id="theme-toggle" class="modern-switch-input" aria-label="{{ 'Theme'|trans }}">
                    <label class="modern-switch-track" for="theme-toggle"><span class="modern-switch-thumb"></span></label>
                    <svg class="icon-sun hide-theme-dark" viewBox="0 0 24 24">
                        <path fill="#f59e0b" d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5.64 5.64L4.22 4.22m15.56 15.56l-1.42-1.42M18.36 5.64l1.42-1.42M5.64 18.36L4.22 19.78"></path>
                    </svg>
                    <svg class="icon-moon hide-theme-light" viewBox="0 0 24 24">
                        <path fill="#60a5fa" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
                </div>
            </div>

            <div class="md:hidden">
                <button type="button" class="modern-btn-secondary" data-mobile-menu-toggle>
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>
</header>
<div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-30 z-40 hidden"></div>

<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col lg:flex-row items-start gap-8">
        {% if client or not settings.hide_menu %}
            <aside class="w-full lg:w-64 flex-shrink-0 modern-card modern-sidebar">
                {{ include('partial_menu.html.twig') }}
            </aside>
        {% endif %}

        <div class="flex-1 min-w-0">
            {% block content_before %}{% endblock %}
            
            {% if settings.show_breadcrumb %}
                {% block breadcrumbs %}
                    <nav class="mb-6" aria-label="{{ 'breadcrumb'|trans }}">
                        <ol class="flex items-center space-x-2 text-sm">
                            <li class="flex items-center">
                                <a href="{{ '/'|link }}" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                                    <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                    </svg>
                                    {{ 'Home'|trans }}
                                </a>
                            </li>
                            {% block breadcrumb %}
                                <li class="flex items-center">
                                    <svg class="h-4 w-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <span class="text-gray-900 dark:text-gray-100 font-medium">{{ 'Dashboard'|trans }}</span>
                                </li>
                            {% endblock %}
                        </ol>
                    </nav>
                {% endblock %}
            {% endif %}

            <div class="space-y-6">
                {% block content %}{% endblock %}
            </div>

            {{ include('partial_message.html.twig') }}

            {% block content_after %}{% endblock %}
        </div>
    </div>
</main>

{% if settings.footer_enabled %}
    <footer class="modern-footer mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="modern-footer-credits">
                <div class="mb-2">
                    &copy; {{ now|format_date(pattern='yyyy') }} {{ settings.footer_signature | default(company.signature) }}
                    {% if company.bank_info_pagebottom == 1 %}
                        <br>
                        <strong>{{'Payment Information'|trans}}</strong> - {{'Bank Name'|trans}}: {{ company.bank_name }} | {{'BIC / SWIFT Code'|trans}}: {{ company.bic }} | {{'Account Number'|trans}}: {{ company.account_number }}
                    {% endif %}
                </div>
                
                <div class="flex flex-wrap justify-center items-center gap-4 text-xs">
                    {% if settings.footer_link_1_enabled %}
                        <a href="{% if 'http://' in settings.footer_link_1_page or 'https://' in settings.footer_link_1_page %}{{ settings.footer_link_1_page }}{% else %}{{ settings.footer_link_1_page | link }}{% endif %}" 
                           class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
                            {{ settings.footer_link_1_title }}
                        </a>
                    {% endif %}
                    
                    {% if settings.footer_link_2_enabled %}
                        <span class="text-gray-400">•</span>
                        <a href="{% if 'http://' in settings.footer_link_2_page or 'https://' in settings.footer_link_2_page %}{{ settings.footer_link_2_page }}{% else %}{{ settings.footer_link_2_page | link }}{% endif %}" 
                           class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
                            {{ settings.footer_link_2_title }}
                        </a>
                    {% endif %}
                    
                    {% if settings.footer_link_3_enabled %}
                        <span class="text-gray-400">•</span>
                        <a href="{% if 'http://' in settings.footer_link_3_page or 'https://' in settings.footer_link_3_page %}{{ settings.footer_link_3_page }}{% else %}{{ settings.footer_link_3_page | link }}{% endif %}" 
                           class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
                            {{ settings.footer_link_3_title }}
                        </a>
                    {% endif %}
                    
                    {% if settings.footer_link_4_enabled %}
                        <span class="text-gray-400">•</span>
                        <a href="{% if 'http://' in settings.footer_link_4_page or 'https://' in settings.footer_link_4_page %}{{ settings.footer_link_4_page }}{% else %}{{ settings.footer_link_4_page | link }}{% endif %}" 
                           class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
                            {{ settings.footer_link_4_title }}
                        </a>
                    {% endif %}
                </div>
                
                {% if guest.extension_is_on({"mod":'branding'}) %}
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                            {{ 'Powered by'|trans }} 
                            <a href="https://fossbilling.org" target="_blank" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200">
                                {{ 'FOSSBilling Community'|trans }}
                            </a>
                            • 
                            <span class="text-purple-600 dark:text-purple-400">
                                {{ 'Modern Theme'|trans }} 
                                <a href="https://fossbilling-theme-modern.highmark.it" target="_blank" class="hover:text-purple-800 dark:hover:text-purple-300 transition-colors duration-200">
                                    {{ 'created by HighMark IT'|trans }}
                                </a>
                            </span>
                            • 
                            <a href="https://github.com/HighMark-31/fossbilling-theme-modern" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200">
                                <svg class="h-4 w-4 inline mr-1" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                {{ 'View on GitHub'|trans }}
                            </a>
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </footer>
{% endif %}

{% if settings.footer_to_top_enabled %}
    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
            class="fixed bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 z-50">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>
{% endif %}

<div class="wait fixed inset-0 bg-black bg-opacity-50 z-50 hidden" onclick="$(this).hide();">
    <div class="flex items-center justify-center h-full">
        <div class="modern-spinner h-12 w-12 text-white"></div>
    </div>
</div>

<noscript>
    <div class="modern-alert modern-alert-warning">
        <strong>{{ 'JavaScript Required'|trans }}</strong><br>
        {{ "NOTE: Many features on FOSSBilling require Javascript and cookies. You can enable both in your browser's preference settings."|trans }}
    </div>
</noscript>

{% endblock %}

{% if settings.inject_javascript %}
    {{ settings.inject_javascript | raw }}
{% endif %}

<div class="toast-container fixed bottom-4 right-4 z-50 space-y-2"></div>

{{ include('partial_pending_messages.html.twig', ignore_missing: true) }}
{% if guest.extension_is_on({ "mod": "cookieconsent" }) %}
    {{ include('mod_cookieconsent_index.html.twig', ignore_missing: true) }}
{% endif %}

{{ DebugBar_render() }}
</body>
</html>